(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},1008:(e,t,a)=>{"use strict";a.d(t,{h:()=>o});let r="https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api";console.log("API Configuration:",{NEXT_PUBLIC_API_URL:"https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api",FINAL_API_URL:r});let n={BASE_URL:r},o=()=>(console.log("=== API BASE URL DEBUG ==="),console.log("Environment Variable NEXT_PUBLIC_API_URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Fallback URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Final API_CONFIG.BASE_URL:",n.BASE_URL),console.log("========================="),n.BASE_URL)},2797:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,347,23)),Promise.resolve().then(a.bind(a,9151))},5038:(e,t,a)=>{"use strict";a.d(t,{Bk:()=>u,QT:()=>c,Sk:()=>l,XI:()=>s});var r=a(5155),n=a(2115),o=a(6681);let i=(0,n.createContext)(null);function s(e){let{children:t}=e,{user:a,isAuthenticated:n}=(0,o.h)(),s=e=>!!a&&!!n&&a.role===e;return(0,r.jsx)(i.Provider,{value:{hasPermission:(e,t)=>{var r;return!!a&&!!n&&!!a.permissions&&(null==(r=a.permissions[e])?void 0:r[t])===!0},hasRole:s,isAdmin:()=>!!a&&!!n&&(s("admin")||s("superadmin")),isSuperAdmin:()=>!!a&&!!n&&s("superadmin")},children:t})}function l(){let e=(0,n.useContext)(i);if(!e)throw Error("usePermissions must be used within a PermissionProvider");return e}function u(e){let{children:t,resource:a,action:n,roles:o,fallback:i=null,requireAll:s=!1}=e;try{let{hasPermission:e,hasRole:u}=l();if(!(()=>{let t=[];return a&&n&&t.push(e(a,n)),o&&o.length>0&&(s?t.push(o.every(e=>u(e))):t.push(o.some(e=>u(e)))),0===t.length||(s?t.every(e=>e):t.some(e=>e))})())return(0,r.jsx)(r.Fragment,{children:i});return(0,r.jsx)(r.Fragment,{children:t})}catch(e){return console.warn("PermissionGate error:",e),(0,r.jsx)(r.Fragment,{children:i})}}function c(){let{hasPermission:e,hasRole:t,isAdmin:a,isSuperAdmin:r}=l();return{hasPermission:e,hasRole:t,isAdmin:a,isSuperAdmin:r,canAccess:(t,a)=>e(t,a),canManageUsers:()=>e("users","write"),canManageRoles:()=>e("roles","write"),canDeleteUsers:()=>e("users","delete"),canDeleteRoles:()=>e("roles","delete"),canViewAuditLogs:()=>e("audit","read"),canManageOrganization:()=>e("organizations","write")}}},6681:(e,t,a)=>{"use strict";a.d(t,{h:()=>i});var r=a(4540),n=a(2115),o=a(7218);let i=()=>{let e=(0,r.wA)(),{user:t,organization:a,isAuthenticated:i,isLoading:s,error:l}=(0,r.d4)(e=>e.auth),u=(0,n.useCallback)(async t=>await e((0,o.Lx)(t)),[e]),c=(0,n.useCallback)(async t=>await e((0,o.d3)(t)),[e]),d=(0,n.useCallback)(async()=>await e((0,o.y4)()),[e]),h=(0,n.useCallback)(()=>{e((0,o.ET)())},[e]);return{user:t,organization:a,isAuthenticated:i,isLoading:s,error:l,login:u,register:c,logout:d,clearError:h,checkAuth:(0,n.useCallback)(async()=>await e((0,o.z)()),[e]),refreshToken:(0,n.useCallback)(async()=>await e((0,o.B3)()),[e])}}},7218:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>g,B3:()=>s,ET:()=>d,Lx:()=>o,d3:()=>i,y4:()=>l,z:()=>u});var r=a(1990),n=a(9959);let o=(0,r.zD)("auth/login",async(e,t)=>{let{rejectWithValue:a}=t;try{return await n.A.login(e)}catch(e){return a(e.message||"Login failed")}}),i=(0,r.zD)("auth/register",async(e,t)=>{let{rejectWithValue:a}=t;try{return await n.A.register(e)}catch(e){return a(e.message||"Registration failed")}}),s=(0,r.zD)("auth/refreshToken",async(e,t)=>{let{rejectWithValue:a}=t;try{return{token:await n.A.refreshToken()}}catch(e){return a(e.message||"Token refresh failed")}}),l=(0,r.zD)("auth/logout",async()=>{await n.A.logout()}),u=(0,r.zD)("auth/checkStatus",async(e,t)=>{let{rejectWithValue:a}=t;try{if(!n.A.isAuthenticated())throw Error("Not authenticated");let e=await n.A.ensureValidToken();if(!e)throw Error("Invalid token");let t=n.A.getUser(),a=n.A.getOrganization();return{user:t,organization:a,token:e}}catch(e){return a(e.message||"Authentication check failed")}}),c=(0,r.Z0)({name:"auth",initialState:{user:null,organization:null,token:null,isAuthenticated:!1,isLoading:!1,error:null},reducers:{clearError:e=>{e.error=null},setCredentials:(e,t)=>{e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}},extraReducers:e=>{e.addCase(o.pending,e=>{e.isLoading=!0,e.error=null}).addCase(o.fulfilled,(e,t)=>{e.isLoading=!1,e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(o.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload,e.isAuthenticated=!1,e.user=null,e.organization=null,e.token=null}).addCase(i.pending,e=>{e.isLoading=!0,e.error=null}).addCase(i.fulfilled,e=>{e.isLoading=!1,e.error=null}).addCase(i.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload}).addCase(s.fulfilled,(e,t)=>{e.token=t.payload.token}).addCase(s.rejected,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1}).addCase(u.fulfilled,(e,t)=>{e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(u.rejected,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1}).addCase(l.fulfilled,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1,e.error=null})}}),{clearError:d,setCredentials:h}=c.actions,g=c.reducer},9151:(e,t,a)=>{"use strict";a.d(t,{Providers:()=>y});var r=a(5155),n=a(4540),o=a(1990);let i=(0,o.Z0)({name:"counter",initialState:{value:0},reducers:{increment:e=>{e.value+=1},decrement:e=>{e.value-=1},incrementByAmount:(e,t)=>{e.value+=t.payload}}}),{increment:s,decrement:l,incrementByAmount:u}=i.actions,c=i.reducer;var d=a(7218);let h=(0,o.U1)({reducer:{counter:c,auth:d.Ay}});var g=a(2115),k=a(6681);function f(e){let{children:t}=e,{checkAuth:a}=(0,k.h)();return(0,g.useEffect)(()=>{a()},[a]),(0,r.jsx)(r.Fragment,{children:t})}var p=a(5038);function y(e){let{children:t}=e;return(0,r.jsx)(n.Kq,{store:h,children:(0,r.jsx)(f,{children:(0,r.jsx)(p.XI,{children:t})})})}},9959:(e,t,a)=>{"use strict";a.d(t,{A:()=>i,y:()=>o});let r=(0,a(1008).h)();class n{getAuthHeaders(){let e=this.getToken();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}async login(e){let t=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.error||"Login failed");return a.token&&(this.setToken(a.token),this.setUser(a.user),this.setOrganization(a.organization)),a}async register(e){let t=await fetch("".concat(r,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.error||"Registration failed");return a}async refreshToken(){let e=this.getToken();if(!e)throw Error("No token available for refresh");let t=await fetch("".concat(r,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),a=await t.json();if(!t.ok)throw Error(a.error||"Token refresh failed");return this.setToken(a.token),a.token}async logout(){try{this.getToken()&&await fetch("".concat(r,"/auth/logout"),{method:"POST",headers:this.getAuthHeaders()})}catch(e){console.warn("Logout API call failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_organization")}}getToken(){return localStorage.getItem("auth_token")}setToken(e){localStorage.setItem("auth_token",e)}getUser(){{let e=localStorage.getItem("auth_user");return e?JSON.parse(e):null}}setUser(e){localStorage.setItem("auth_user",JSON.stringify(e))}getOrganization(){{let e=localStorage.getItem("auth_organization");return e?JSON.parse(e):null}}setOrganization(e){localStorage.setItem("auth_organization",JSON.stringify(e))}isAuthenticated(){return!!this.getToken()}isTokenExpired(){let e=this.getToken();if(!e)return!0;try{let t=JSON.parse(atob(e.split(".")[1])),a=Date.now()/1e3;return t.exp<a}catch(e){return!0}}async ensureValidToken(){if(!this.isAuthenticated())return null;if(this.isTokenExpired())try{return await this.refreshToken()}catch(e){return localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_organization"),null}return this.getToken()}}let o=new n,i=o}},e=>{e.O(0,[690,635,441,964,977],()=>e(e.s=2797)),_N_E=e.O()}]);