(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[875],{1008:(e,t,a)=>{"use strict";a.d(t,{h:()=>n});let r="https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api";console.log("API Configuration:",{NEXT_PUBLIC_API_URL:"https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api",FINAL_API_URL:r});let s={BASE_URL:r},n=()=>(console.log("=== API BASE URL DEBUG ==="),console.log("Environment Variable NEXT_PUBLIC_API_URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Fallback URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Final API_CONFIG.BASE_URL:",s.BASE_URL),console.log("========================="),s.BASE_URL)},2842:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(2115);let s=r.forwardRef(function(e,t){let{title:a,titleId:s,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),a?r.createElement("title",{id:s},a):null,r.createElement("path",{fillRule:"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z",clipRule:"evenodd"}))})},3672:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(2115);let s=r.forwardRef(function(e,t){let{title:a,titleId:s,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),a?r.createElement("title",{id:s},a):null,r.createElement("path",{d:"M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-12.15 12.15a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32L19.513 8.2Z"}))})},4744:(e,t,a)=>{"use strict";a.d(t,{D:()=>l});var r=a(9959);let s=(0,a(1008).h)();class n{getAuthHeaders(){let e=localStorage.getItem("auth_token");return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}async handleAuthError(e){401===e.status&&(console.warn("Authentication failed, logging out user"),await r.y.logout(),window.location.href="/login")}async getUsers(){console.log("Fetching users from:","".concat(s,"/users")),console.log("Auth token:",localStorage.getItem("auth_token")?"Present":"Missing");let e=await fetch("".concat(s,"/users"),{headers:this.getAuthHeaders()});if(console.log("Response status:",e.status),!e.ok){await this.handleAuthError(e);let t=await e.json().catch(()=>({}));throw console.error("Error response:",t),Error(t.error||"Failed to fetch users: ".concat(e.status))}return e.json()}async getUserById(e){let t=await fetch("".concat(s,"/users/").concat(e),{headers:this.getAuthHeaders()});if(!t.ok)throw Error((await t.json().catch(()=>({}))).error||"Failed to fetch user: ".concat(t.status));return t.json()}async createUser(e){let t=await fetch("".concat(s,"/users"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).error||"Failed to create user: ".concat(t.status));return t.json()}async updateUser(e,t){let a=await fetch("".concat(s,"/users/").concat(e),{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json().catch(()=>({}))).error||"Failed to update user: ".concat(a.status));return a.json()}async deleteUser(e){let t=await fetch("".concat(s,"/users/").concat(e),{method:"DELETE",headers:this.getAuthHeaders()});if(!t.ok)throw await this.handleAuthError(t),Error((await t.json().catch(()=>({}))).error||"Failed to delete user: ".concat(t.status))}}let l=new n},5038:(e,t,a)=>{"use strict";a.d(t,{Bk:()=>c,QT:()=>d,Sk:()=>i,XI:()=>o});var r=a(5155),s=a(2115),n=a(6681);let l=(0,s.createContext)(null);function o(e){let{children:t}=e,{user:a,isAuthenticated:s}=(0,n.h)(),o=e=>!!a&&!!s&&a.role===e;return(0,r.jsx)(l.Provider,{value:{hasPermission:(e,t)=>{var r;return!!a&&!!s&&!!a.permissions&&(null==(r=a.permissions[e])?void 0:r[t])===!0},hasRole:o,isAdmin:()=>!!a&&!!s&&(o("admin")||o("superadmin")),isSuperAdmin:()=>!!a&&!!s&&o("superadmin")},children:t})}function i(){let e=(0,s.useContext)(l);if(!e)throw Error("usePermissions must be used within a PermissionProvider");return e}function c(e){let{children:t,resource:a,action:s,roles:n,fallback:l=null,requireAll:o=!1}=e;try{let{hasPermission:e,hasRole:c}=i();if(!(()=>{let t=[];return a&&s&&t.push(e(a,s)),n&&n.length>0&&(o?t.push(n.every(e=>c(e))):t.push(n.some(e=>c(e)))),0===t.length||(o?t.every(e=>e):t.some(e=>e))})())return(0,r.jsx)(r.Fragment,{children:l});return(0,r.jsx)(r.Fragment,{children:t})}catch(e){return console.warn("PermissionGate error:",e),(0,r.jsx)(r.Fragment,{children:l})}}function d(){let{hasPermission:e,hasRole:t,isAdmin:a,isSuperAdmin:r}=i();return{hasPermission:e,hasRole:t,isAdmin:a,isSuperAdmin:r,canAccess:(t,a)=>e(t,a),canManageUsers:()=>e("users","write"),canManageRoles:()=>e("roles","write"),canDeleteUsers:()=>e("users","delete"),canDeleteRoles:()=>e("roles","delete"),canViewAuditLogs:()=>e("audit","read"),canManageOrganization:()=>e("organizations","write")}}},5061:(e,t,a)=>{Promise.resolve().then(a.bind(a,9054))},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},6681:(e,t,a)=>{"use strict";a.d(t,{h:()=>l});var r=a(4540),s=a(2115),n=a(7218);let l=()=>{let e=(0,r.wA)(),{user:t,organization:a,isAuthenticated:l,isLoading:o,error:i}=(0,r.d4)(e=>e.auth),c=(0,s.useCallback)(async t=>await e((0,n.Lx)(t)),[e]),d=(0,s.useCallback)(async t=>await e((0,n.d3)(t)),[e]),u=(0,s.useCallback)(async()=>await e((0,n.y4)()),[e]),h=(0,s.useCallback)(()=>{e((0,n.ET)())},[e]);return{user:t,organization:a,isAuthenticated:l,isLoading:o,error:i,login:c,register:d,logout:u,clearError:h,checkAuth:(0,s.useCallback)(async()=>await e((0,n.z)()),[e]),refreshToken:(0,s.useCallback)(async()=>await e((0,n.B3)()),[e])}}},7218:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>g,B3:()=>o,ET:()=>u,Lx:()=>n,d3:()=>l,y4:()=>i,z:()=>c});var r=a(1990),s=a(9959);let n=(0,r.zD)("auth/login",async(e,t)=>{let{rejectWithValue:a}=t;try{return await s.A.login(e)}catch(e){return a(e.message||"Login failed")}}),l=(0,r.zD)("auth/register",async(e,t)=>{let{rejectWithValue:a}=t;try{return await s.A.register(e)}catch(e){return a(e.message||"Registration failed")}}),o=(0,r.zD)("auth/refreshToken",async(e,t)=>{let{rejectWithValue:a}=t;try{return{token:await s.A.refreshToken()}}catch(e){return a(e.message||"Token refresh failed")}}),i=(0,r.zD)("auth/logout",async()=>{await s.A.logout()}),c=(0,r.zD)("auth/checkStatus",async(e,t)=>{let{rejectWithValue:a}=t;try{if(!s.A.isAuthenticated())throw Error("Not authenticated");let e=await s.A.ensureValidToken();if(!e)throw Error("Invalid token");let t=s.A.getUser(),a=s.A.getOrganization();return{user:t,organization:a,token:e}}catch(e){return a(e.message||"Authentication check failed")}}),d=(0,r.Z0)({name:"auth",initialState:{user:null,organization:null,token:null,isAuthenticated:!1,isLoading:!1,error:null},reducers:{clearError:e=>{e.error=null},setCredentials:(e,t)=>{e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,t)=>{e.isLoading=!1,e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(n.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload,e.isAuthenticated=!1,e.user=null,e.organization=null,e.token=null}).addCase(l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(l.fulfilled,e=>{e.isLoading=!1,e.error=null}).addCase(l.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload}).addCase(o.fulfilled,(e,t)=>{e.token=t.payload.token}).addCase(o.rejected,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1}).addCase(c.fulfilled,(e,t)=>{e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(c.rejected,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1}).addCase(i.fulfilled,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1,e.error=null})}}),{clearError:u,setCredentials:h}=d.actions,g=d.reducer},7482:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(2115);let s=r.forwardRef(function(e,t){let{title:a,titleId:s,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),a?r.createElement("title",{id:s},a):null,r.createElement("path",{fillRule:"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z",clipRule:"evenodd"}))})},9054:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var r=a(5155),s=a(2115);let n=s.forwardRef(function(e,t){let{title:a,titleId:r,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),a?s.createElement("title",{id:r},a):null,s.createElement("path",{fillRule:"evenodd",d:"M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z",clipRule:"evenodd"}))});var l=a(7482),o=a(3672),i=a(2842),c=a(5695),d=a(5038),u=a(4744);function h(){let e=(0,c.useRouter)(),[t,a]=(0,s.useState)([]),[h,g]=(0,s.useState)(!0),[m,p]=(0,s.useState)(null),{canManageUsers:x,canDeleteUsers:f}=(0,d.QT)();(0,s.useEffect)(()=>{w()},[]);let w=async()=>{try{let e=await u.D.getUsers();a(e.users),p(null)}catch(a){var e,t;console.error("User fetch error:",a),(null==(e=a.message)?void 0:e.includes("Invalid token"))||(null==(t=a.message)?void 0:t.includes("TOKEN_INVALID"))?(p("Your session has expired. Please log in again."),setTimeout(()=>{window.location.href="/login"},2e3)):p(a.message||"Failed to fetch users")}finally{g(!1)}},b=async(e,t)=>{if(confirm('Are you sure you want to delete user "'.concat(t,'"?')))try{await u.D.deleteUser(e),await w(),p(null)}catch(e){p(e.message||"Failed to delete user")}};return h?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-2 sm:px-6",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-2 sm:px-6",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-black text-gray-900 mb-1 tracking-wider drop-shadow-sm",children:"User Management"}),(0,r.jsx)("div",{className:"text-gray-600 text-base font-medium",children:"Manage user accounts and access privileges"})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 self-start sm:self-auto",children:[(0,r.jsx)(d.Bk,{resource:"roles",action:"read",children:(0,r.jsxs)("button",{className:"bg-green-600 hover:bg-green-700 text-white font-bold px-5 py-2 rounded-lg shadow transition flex items-center gap-2",onClick:()=>e.push("/dashboard/user-management/role-management"),children:[(0,r.jsx)(n,{className:"w-5 h-5"}),"Manage Roles"]})}),(0,r.jsx)(d.Bk,{resource:"users",action:"write",children:(0,r.jsxs)("button",{className:"bg-blue-600 hover:bg-blue-700 text-white font-bold px-5 py-2 rounded-lg shadow transition flex items-center gap-2",onClick:()=>{e.push("/dashboard/user-management/add-user")},children:[(0,r.jsx)(l.A,{className:"w-5 h-5"}),"Add New User"]})})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow border border-blue-100 p-0",children:[(0,r.jsxs)("div",{className:"px-6 pt-6 pb-2 text-lg font-bold text-blue-900",children:["System Users (",t.length,")"]}),m&&(0,r.jsxs)("div",{className:"mx-6 mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded flex items-center justify-between",children:[(0,r.jsx)("span",{children:m}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{p(null),w()},className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm",children:"Retry"}),(0,r.jsx)("a",{href:"/debug-permissions",className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm",children:"Debug"})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full text-sm border border-blue-100 rounded-lg",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-blue-50 text-blue-900",children:[(0,r.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap",children:"Username"}),(0,r.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap",children:"Full Name"}),(0,r.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap",children:"Role"}),(0,r.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap",children:"Last Login"}),(0,r.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:t.map(e=>(0,r.jsxs)("tr",{className:"border-t border-blue-100 hover:bg-blue-50 transition",children:[(0,r.jsx)("td",{className:"py-3 px-4 align-top font-bold text-gray-900 whitespace-nowrap",children:(0,r.jsx)("span",{className:"inline-flex items-center gap-1",children:(0,r.jsx)("span",{className:"font-mono",children:e.username})})}),(0,r.jsxs)("td",{className:"py-3 px-4 align-top text-gray-900 whitespace-nowrap",children:[e.firstName," ",e.lastName]}),(0,r.jsx)("td",{className:"py-3 px-4 align-top whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-3 py-1 rounded text-xs font-semibold ".concat({superadmin:"bg-red-100 text-red-700",admin:"bg-blue-100 text-blue-700",pharmacovigilance:"bg-green-100 text-green-700",sponsor_auditor:"bg-purple-100 text-purple-700"}[e.role]||"bg-gray-100 text-gray-700"),children:e.roleDisplayName||e.role})}),(0,r.jsx)("td",{className:"py-3 px-4 align-top text-gray-700 whitespace-nowrap",children:e.lastLogin?new Date(e.lastLogin).toLocaleDateString():"Never"}),(0,r.jsx)("td",{className:"py-3 px-4 align-top",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(d.Bk,{resource:"users",action:"write",children:(0,r.jsx)("button",{className:"bg-gray-100 hover:bg-blue-100 text-blue-700 p-2 rounded transition",title:"Edit",children:(0,r.jsx)(o.A,{className:"w-4 h-4"})})}),(0,r.jsx)(d.Bk,{resource:"users",action:"delete",children:(0,r.jsx)("button",{onClick:()=>b(e.id,e.username),className:"bg-red-100 hover:bg-red-200 text-red-600 p-2 rounded transition",title:"Delete",children:(0,r.jsx)(i.A,{className:"w-4 h-4"})})})]})})]},e.id))})]})})]})]})})}},9959:(e,t,a)=>{"use strict";a.d(t,{A:()=>l,y:()=>n});let r=(0,a(1008).h)();class s{getAuthHeaders(){let e=this.getToken();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}async login(e){let t=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.error||"Login failed");return a.token&&(this.setToken(a.token),this.setUser(a.user),this.setOrganization(a.organization)),a}async register(e){let t=await fetch("".concat(r,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.error||"Registration failed");return a}async refreshToken(){let e=this.getToken();if(!e)throw Error("No token available for refresh");let t=await fetch("".concat(r,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),a=await t.json();if(!t.ok)throw Error(a.error||"Token refresh failed");return this.setToken(a.token),a.token}async logout(){try{this.getToken()&&await fetch("".concat(r,"/auth/logout"),{method:"POST",headers:this.getAuthHeaders()})}catch(e){console.warn("Logout API call failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_organization")}}getToken(){return localStorage.getItem("auth_token")}setToken(e){localStorage.setItem("auth_token",e)}getUser(){{let e=localStorage.getItem("auth_user");return e?JSON.parse(e):null}}setUser(e){localStorage.setItem("auth_user",JSON.stringify(e))}getOrganization(){{let e=localStorage.getItem("auth_organization");return e?JSON.parse(e):null}}setOrganization(e){localStorage.setItem("auth_organization",JSON.stringify(e))}isAuthenticated(){return!!this.getToken()}isTokenExpired(){let e=this.getToken();if(!e)return!0;try{let t=JSON.parse(atob(e.split(".")[1])),a=Date.now()/1e3;return t.exp<a}catch(e){return!0}}async ensureValidToken(){if(!this.isAuthenticated())return null;if(this.isTokenExpired())try{return await this.refreshToken()}catch(e){return localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_organization"),null}return this.getToken()}}let n=new s,l=n}},e=>{e.O(0,[635,441,964,977],()=>e(e.s=5061)),_N_E=e.O()}]);