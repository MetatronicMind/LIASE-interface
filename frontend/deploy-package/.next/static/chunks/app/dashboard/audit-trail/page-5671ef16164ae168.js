(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[132],{1008:(e,t,l)=>{"use strict";l.d(t,{h:()=>s});let a="https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api";console.log("API Configuration:",{NEXT_PUBLIC_API_URL:"https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api",FINAL_API_URL:a});let r={BASE_URL:a},s=()=>(console.log("=== API BASE URL DEBUG ==="),console.log("Environment Variable NEXT_PUBLIC_API_URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Fallback URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Final API_CONFIG.BASE_URL:",r.BASE_URL),console.log("========================="),r.BASE_URL)},3585:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>g});var a=l(5155),r=l(2115);let s=r.forwardRef(function(e,t){let{title:l,titleId:a,...s}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},s),l?r.createElement("title",{id:a},l):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"}))});var o=l(8227),n=l(6865),i=l(5628);let c=r.forwardRef(function(e,t){let{title:l,titleId:a,...s}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},s),l?r.createElement("title",{id:a},l):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}),d=r.forwardRef(function(e,t){let{title:l,titleId:a,...s}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},s),l?r.createElement("title",{id:a},l):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"}))}),u=(0,l(1008).h)();class b{getAuthToken(){return localStorage.getItem("auth_token")}getAuthHeaders(){let e=this.getAuthToken();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}async getAuditLogs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;Object.entries(e).forEach(e=>{let[l,a]=e;null!=a&&""!==a&&t.append(l,String(a))});try{let e=await fetch("".concat(u,"/audit?").concat(t.toString()),{method:"GET",headers:this.getAuthHeaders()});if(!e.ok){let t=await e.json().catch(()=>({error:"Unknown error"}));if(403===e.status)throw Error("You do not have permission to view audit logs");if(401===e.status)throw Error("Please log in to view audit logs");throw Error(t.error||"Failed to fetch audit logs (".concat(e.status,")"))}return await e.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw Error("Cannot connect to server. Please ensure the backend is running and accessible");throw e}}async getAuditStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=await fetch("".concat(u,"/audit/stats?days=").concat(e),{method:"GET",headers:this.getAuthHeaders()}),l=await t.json();if(!t.ok)throw Error(l.error||"Failed to fetch audit statistics");return l}async getAuditLog(e){let t=await fetch("".concat(u,"/audit/").concat(e),{method:"GET",headers:this.getAuthHeaders()}),l=await t.json();if(!t.ok)throw Error(l.error||"Failed to fetch audit log");return l}async getUsers(){try{let e=await this.getAuditLogs({limit:1e3}),t=new Map;return e.auditLogs.forEach(e=>{t.has(e.userId)||t.set(e.userId,e.userName)}),Array.from(t.entries()).map(e=>{let[t,l]=e;return{id:t,name:l}})}catch(e){return console.error("Error fetching users from audit logs:",e),[]}}getAvailableActions(){return[{value:"login",label:"Login"},{value:"logout",label:"Logout"},{value:"create",label:"Create"},{value:"read",label:"Read"},{value:"update",label:"Update"},{value:"delete",label:"Delete"},{value:"approve",label:"Approve"},{value:"reject",label:"Reject"},{value:"comment",label:"Comment"}]}async exportAuditLogsCSV(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=(await this.getAuditLogs({...e,limit:1e4})).auditLogs.map(e=>{var t,l;return[new Date(e.timestamp).toLocaleString(),e.userName,e.action,e.resource,(null==(t=e.location)?void 0:t.country)||"Unknown",(null==(l=e.location)?void 0:l.city)||"Unknown",e.ipAddress||"N/A",e.details]}),l=[["Timestamp","User","Action","Resource","Country","City","IP Address","Details"],...t].map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n"),a=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download="audit_trail_".concat(new Date().toISOString().split("T")[0],".csv"),s.click(),URL.revokeObjectURL(r)}catch(e){throw console.error("Error exporting audit logs:",e),e}}}let m=new b,x={login:{label:"Login",icon:(0,a.jsx)(s,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-blue-600"},logout:{label:"Logout",icon:(0,a.jsx)(s,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-gray-600"},comment:{label:"Comment",icon:(0,a.jsx)(o.A,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-gray-500"},approve:{label:"Approve",icon:(0,a.jsx)(n.A,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-green-600"},reject:{label:"Reject",icon:(0,a.jsx)(i.A,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-red-600"},create:{label:"Create",icon:(0,a.jsx)(c,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-green-600"},update:{label:"Update",icon:(0,a.jsx)(c,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-amber-600"},delete:{label:"Delete",icon:(0,a.jsx)(i.A,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-red-600"},read:{label:"Read",icon:(0,a.jsx)(c,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-blue-500"}};function h(e){return x[e]||{label:e.charAt(0).toUpperCase()+e.slice(1),icon:r.createElement(c,{className:"w-4 h-4 mr-1 inline-block align-middle"}),color:"text-gray-600"}}function g(){let[e,t]=(0,r.useState)([]),[l,s]=(0,r.useState)([]),[o,n]=(0,r.useState)(!0),[i,c]=(0,r.useState)(null),[u,b]=(0,r.useState)(0),[x,g]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[v,w]=(0,r.useState)(""),[j,y]=(0,r.useState)(""),[N,k]=(0,r.useState)(1),[A,E]=(0,r.useState)(10),L=m.getAvailableActions(),C=async()=>{try{n(!0),c(null);let e={page:N,limit:A,...x&&{userId:x},...p&&{action:p},...v&&{startDate:v},...j&&{endDate:j},sortOrder:"desc"},l=await m.getAuditLogs(e);t(l.auditLogs),b(l.pagination.total)}catch(e){c(e instanceof Error?e.message:"Failed to fetch audit logs"),console.error("Error fetching audit logs:",e)}finally{n(!1)}},S=async()=>{try{let e=await m.getUsers();s(e)}catch(e){console.error("Error fetching users:",e)}};(0,r.useEffect)(()=>{C()},[N,A,x,p,v,j]),(0,r.useEffect)(()=>{S()},[]);let U=Math.ceil(u/A),R=L.map(t=>({...t,count:e.filter(e=>e.action===t.value).length}));async function _(){try{let e={...x&&{userId:x},...p&&{action:p},...v&&{startDate:v},...j&&{endDate:j}};await m.exportAuditLogsCSV(e)}catch(e){c(e instanceof Error?e.message:"Failed to export audit logs")}}return(0,a.jsx)("div",{className:"bg-gradient-to-br from-blue-50 via-cyan-50 to-white min-h-screen p-4 sm:p-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-4xl font-black text-blue-900 mb-1 tracking-wider drop-shadow-sm",children:"Audit Trail"}),(0,a.jsx)("div",{className:"text-blue-700 text-base font-medium",children:"Complete log of all user activities and system events"})]}),(0,a.jsxs)("button",{className:"bg-green-100 hover:bg-green-200 text-green-800 font-bold px-5 py-2 rounded-lg shadow transition flex items-center gap-2 self-start sm:self-auto",onClick:_,children:[(0,a.jsx)(d,{className:"w-5 h-5 text-green-700"})," Export CSV"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow border border-blue-100 p-6 mb-8",children:[(0,a.jsx)("div",{className:"font-bold text-lg text-blue-900 mb-4",children:"Filters"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-blue-900 mb-1",children:"User"}),(0,a.jsxs)("select",{value:x,onChange:e=>{g(e.target.value),k(1)},className:"w-full border border-blue-200 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500 bg-white text-blue-900",children:[(0,a.jsx)("option",{value:"",children:"All Users"}),l.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-blue-900 mb-1",children:"Action"}),(0,a.jsxs)("select",{value:p,onChange:e=>{f(e.target.value),k(1)},className:"w-full border border-blue-200 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500 bg-white text-blue-900",children:[(0,a.jsx)("option",{value:"",children:"All Actions"}),L.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-blue-900 mb-1",children:"Date From"}),(0,a.jsx)("input",{type:"date",value:v,onChange:e=>{w(e.target.value),k(1)},className:"w-full border border-blue-200 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500 bg-white text-blue-900"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-blue-900 mb-1",children:"Date To"}),(0,a.jsx)("input",{type:"date",value:j,onChange:e=>{y(e.target.value),k(1)},className:"w-full border border-blue-200 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500 bg-white text-blue-900"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between border-t border-blue-100 pt-4 mt-2",children:[(0,a.jsx)("button",{className:"px-5 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 font-semibold text-base",onClick:function(){g(""),f(""),w(""),y(""),k(1)},children:"Clear Filters"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[u," records found"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow border border-blue-100 p-0 mb-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between px-6 pt-6 pb-2 gap-4",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-blue-900",children:"Activity Log"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"pageSize",className:"text-sm font-medium text-blue-900",children:"Show"}),(0,a.jsxs)("select",{id:"pageSize",value:A,onChange:e=>{E(Number(e.target.value)),k(1)},className:"border border-blue-200 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500 bg-white text-blue-900",children:[(0,a.jsx)("option",{value:10,children:"10"}),(0,a.jsx)("option",{value:50,children:"50"}),(0,a.jsx)("option",{value:100,children:"100"})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-sm border border-blue-200 rounded-lg",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-blue-50 text-blue-900",children:[(0,a.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap border-b border-blue-200",children:"Timestamp"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap border-b border-blue-200",children:"User"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap border-b border-blue-200",children:"Action"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap border-b border-blue-200",children:"Location"}),(0,a.jsx)("th",{className:"py-3 px-4 text-left font-semibold whitespace-nowrap border-b border-blue-200",children:"Details"})]})}),(0,a.jsx)("tbody",{children:o?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"text-center py-6 text-gray-400 border-b border-blue-100",children:"Loading..."})}):i?(0,a.jsx)("tr",{children:(0,a.jsxs)("td",{colSpan:5,className:"text-center py-6 text-red-500 border-b border-blue-100",children:["Error: ",i]})}):0===e.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"text-center py-6 text-gray-400 border-b border-blue-100",children:"No records found."})}):e.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b border-blue-50 last:border-b-0",children:[(0,a.jsx)("td",{className:"py-3 px-4 align-top text-blue-900",children:new Date(e.timestamp).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}),(0,a.jsxs)("td",{className:"py-3 px-4 align-top text-blue-900 font-bold",children:[e.userName,(0,a.jsxs)("div",{className:"text-xs text-gray-600 font-normal",children:["ID: ",e.userId]})]}),(0,a.jsx)("td",{className:"py-3 px-4 align-top",children:(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded bg-gray-100 text-gray-800 font-semibold text-xs",children:[h(e.action).icon,h(e.action).label]})}),(0,a.jsx)("td",{className:"py-3 px-4 align-top text-blue-900 text-xs",children:e.location?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:e.location.country}),(0,a.jsx)("div",{className:"text-gray-500",children:e.location.city}),(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:e.ipAddress})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-gray-500",children:"Unknown"}),(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:e.ipAddress||"N/A"})]})}),(0,a.jsx)("td",{className:"py-3 px-4 align-top text-blue-900",children:e.details})]},t))})]})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 px-6 py-4 border-t border-blue-100 bg-blue-50 rounded-b-xl",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",0===u?0:(N-1)*A+1,"-",Math.min(N*A,u)," of ",u]}),(0,a.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50 border border-gray-300",onClick:()=>k(1),disabled:1===N,title:"First page",children:"\xab"}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50 border border-gray-300",onClick:()=>k(e=>Math.max(1,e-1)),disabled:1===N,title:"Previous page",children:"‹"}),(0,a.jsxs)("span",{className:"px-2 text-gray-700 font-semibold",children:["Page ",N," of ",U||1]}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50 border border-gray-300",onClick:()=>k(e=>Math.min(U,e+1)),disabled:N===U||0===U,title:"Next page",children:"›"}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50 border border-gray-300",onClick:()=>k(U),disabled:N===U||0===U,title:"Last page",children:"\xbb"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow border border-blue-100 p-6",children:[(0,a.jsx)("div",{className:"font-bold text-lg text-blue-900 mb-4",children:"Activity Summary"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:R.map((e,t)=>{let l=h(e.value);return(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 rounded-lg px-4 py-3 text-base font-semibold text-blue-900",children:[(0,a.jsx)("span",{className:"text-xl ".concat(l.color),children:l.icon}),(0,a.jsx)("span",{children:e.label}),(0,a.jsx)("span",{className:"ml-auto text-blue-700 font-black text-lg",children:e.count})]},e.value)})})]})]})})}},5628:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var a=l(2115);let r=a.forwardRef(function(e,t){let{title:l,titleId:r,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},s),l?a.createElement("title",{id:r},l):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))})},6865:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var a=l(2115);let r=a.forwardRef(function(e,t){let{title:l,titleId:r,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},s),l?a.createElement("title",{id:r},l):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))})},7702:(e,t,l)=>{Promise.resolve().then(l.bind(l,3585))},8227:(e,t,l)=>{"use strict";l.d(t,{A:()=>r});var a=l(2115);let r=a.forwardRef(function(e,t){let{title:l,titleId:r,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},s),l?a.createElement("title",{id:r},l):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 9.75a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 0 1 .778-.332 48.294 48.294 0 0 0 5.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"}))})}},e=>{e.O(0,[441,964,977],()=>e(e.s=7702)),_N_E=e.O()}]);