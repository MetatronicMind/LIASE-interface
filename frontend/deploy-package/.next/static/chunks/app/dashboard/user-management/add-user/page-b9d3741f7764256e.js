(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657,733],{1008:(e,t,r)=>{"use strict";r.d(t,{h:()=>o});let a="https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api";console.log("API Configuration:",{NEXT_PUBLIC_API_URL:"https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api",FINAL_API_URL:a});let s={BASE_URL:a},o=()=>(console.log("=== API BASE URL DEBUG ==="),console.log("Environment Variable NEXT_PUBLIC_API_URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Fallback URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Final API_CONFIG.BASE_URL:",s.BASE_URL),console.log("========================="),s.BASE_URL)},1637:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),s=r(2115),o=r(5695);let n=s.forwardRef(function(e,t){let{title:r,titleId:a,...o}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},o),r?s.createElement("title",{id:a},r):null,s.createElement("path",{fillRule:"evenodd",d:"M11.03 3.97a.75.75 0 0 1 0 1.06l-6.22 6.22H21a.75.75 0 0 1 0 1.5H4.81l6.22 6.22a.75.75 0 1 1-1.06 1.06l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 0 1 1.06 0Z",clipRule:"evenodd"}))});var l=r(4744),i=r(9733);function c(){let e=(0,o.useRouter)(),[t,r]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!0),[u,h]=(0,s.useState)(null),[m,g]=(0,s.useState)([]),[f,p]=(0,s.useState)(!0),[w,b]=(0,s.useState)({username:"",firstName:"",lastName:"",email:"",password:"",role:""});(0,s.useEffect)(()=>{y()},[]);let y=async()=>{try{let e=await i.roleService.getRoles();g(e),h(null)}catch(r){var e,t;console.error("Roles fetch error:",r),(null==(e=r.message)?void 0:e.includes("Permission denied"))||(null==(t=r.message)?void 0:t.includes("Forbidden"))?(console.log("User lacks roles:read permission, using fallback system roles"),p(!1),g([{id:"admin",name:"admin",displayName:"Administrator",permissions:{}},{id:"pharmacovigilance",name:"pharmacovigilance",displayName:"Pharmacovigilance Specialist",permissions:{}},{id:"sponsor_auditor",name:"sponsor_auditor",displayName:"Sponsor Auditor",permissions:{}}]),h("Note: Limited role selection available. Contact your administrator to access custom roles.")):h("Failed to load roles")}finally{d(!1)}},x=e=>{let{name:t,value:r}=e.target;b(e=>({...e,[t]:r}))},j=async t=>{t.preventDefault(),r(!0),h(null);try{if(!w.username||!w.firstName||!w.lastName||!w.email||!w.password||!w.role)throw Error("All fields are required");if(w.password.length<6)throw Error("Password must be at least 6 characters long");let t=await l.D.createUser(w);console.log("User created successfully:",t),alert('User "'.concat(w.username,'" created successfully!')),e.push("/dashboard/user-management")}catch(e){console.error("User creation error:",e),h(e.message||"Failed to create user")}finally{r(!1)}},A=()=>{e.push("/dashboard/user-management")};return c?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-2 sm:px-6",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading roles..."})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-2 sm:px-6",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center mb-8",children:[(0,a.jsx)("button",{onClick:A,className:"mr-4 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",children:(0,a.jsx)(n,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Add New User"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Create a new user account"})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-xl shadow border border-blue-100",children:(0,a.jsxs)("form",{onSubmit:j,className:"p-6 space-y-6",children:[u&&(0,a.jsx)("div",{className:"px-4 py-3 rounded ".concat(u.includes("Note:")?"bg-yellow-100 border border-yellow-400 text-yellow-800":"bg-red-100 border border-red-400 text-red-700"),children:u}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:"Username *"}),(0,a.jsx)("input",{type:"text",id:"username",name:"username",value:w.username,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter username",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),(0,a.jsx)("input",{type:"text",id:"firstName",name:"firstName",value:w.firstName,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter first name",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),(0,a.jsx)("input",{type:"text",id:"lastName",name:"lastName",value:w.lastName,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter last name",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:w.email,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter email address",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),(0,a.jsx)("input",{type:"password",id:"password",name:"password",value:w.password,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter password (min 6 characters)",required:!0,minLength:6})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-2",children:"Role *"}),(0,a.jsxs)("select",{id:"role",name:"role",value:w.role,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select a role"}),m.map(e=>(0,a.jsx)("option",{value:e.name,children:e.displayName||e.name},e.id))]}),!f&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Only system roles are available. Ask your administrator about custom roles."})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:A,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",disabled:t,children:"Cancel"}),(0,a.jsxs)("button",{type:"submit",disabled:t,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[t&&(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),t?"Creating...":"Create User"]})]})]})})]})})}},4744:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var a=r(9959);let s=(0,r(1008).h)();class o{getAuthHeaders(){let e=localStorage.getItem("auth_token");return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}async handleAuthError(e){401===e.status&&(console.warn("Authentication failed, logging out user"),await a.y.logout(),window.location.href="/login")}async getUsers(){console.log("Fetching users from:","".concat(s,"/users")),console.log("Auth token:",localStorage.getItem("auth_token")?"Present":"Missing");let e=await fetch("".concat(s,"/users"),{headers:this.getAuthHeaders()});if(console.log("Response status:",e.status),!e.ok){await this.handleAuthError(e);let t=await e.json().catch(()=>({}));throw console.error("Error response:",t),Error(t.error||"Failed to fetch users: ".concat(e.status))}return e.json()}async getUserById(e){let t=await fetch("".concat(s,"/users/").concat(e),{headers:this.getAuthHeaders()});if(!t.ok)throw Error((await t.json().catch(()=>({}))).error||"Failed to fetch user: ".concat(t.status));return t.json()}async createUser(e){let t=await fetch("".concat(s,"/users"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).error||"Failed to create user: ".concat(t.status));return t.json()}async updateUser(e,t){let r=await fetch("".concat(s,"/users/").concat(e),{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify(t)});if(!r.ok)throw Error((await r.json().catch(()=>({}))).error||"Failed to update user: ".concat(r.status));return r.json()}async deleteUser(e){let t=await fetch("".concat(s,"/users/").concat(e),{method:"DELETE",headers:this.getAuthHeaders()});if(!t.ok)throw await this.handleAuthError(t),Error((await t.json().catch(()=>({}))).error||"Failed to delete user: ".concat(t.status))}}let n=new o},5642:(e,t,r)=>{Promise.resolve().then(r.bind(r,1637))},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},9733:(e,t,r)=>{"use strict";r.d(t,{roleService:()=>o});var a=r(1008);class s{getAuthHeaders(){let e=localStorage.getItem("auth_token");return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}async handleAuthError(e){401===e.status?(console.warn("Authentication failed, redirecting to login"),window.location.href="/login"):403===e.status&&console.warn("Access forbidden - user lacks required permissions")}async getRoles(){let e=await fetch("".concat(this.API_BASE_URL,"/roles"),{headers:this.getAuthHeaders()});if(!e.ok)throw await this.handleAuthError(e),Error((await e.json().catch(()=>({}))).error||"Failed to fetch roles");let t=await e.json();return t.roles||t}async getRole(e){let t=await fetch("".concat(this.API_BASE_URL,"/roles/").concat(e),{headers:this.getAuthHeaders()});if(!t.ok)throw await this.handleAuthError(t),Error((await t.json().catch(()=>({}))).error||"Failed to fetch role");return(await t.json()).role}async createRole(e){let t=await fetch("".concat(this.API_BASE_URL,"/roles"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});if(!t.ok)throw await this.handleAuthError(t),Error((await t.json().catch(()=>({}))).error||"Failed to create role");let r=await t.json();return r.role||r}async updateRole(e,t){let r=await fetch("".concat(this.API_BASE_URL,"/roles/").concat(e),{method:"PUT",headers:this.getAuthHeaders(),body:JSON.stringify(t)});if(!r.ok)throw await this.handleAuthError(r),Error((await r.json().catch(()=>({}))).error||"Failed to update role");let a=await r.json();return a.role||a}async deleteRole(e){let t=await fetch("".concat(this.API_BASE_URL,"/roles/").concat(e),{method:"DELETE",headers:this.getAuthHeaders()});if(!t.ok)throw await this.handleAuthError(t),Error((await t.json().catch(()=>({}))).error||"Failed to delete role")}async getPermissionStructure(){let e=await fetch("".concat(this.API_BASE_URL,"/roles/system/permissions"),{headers:this.getAuthHeaders()});if(!e.ok)throw await this.handleAuthError(e),Error((await e.json().catch(()=>({}))).error||"Failed to fetch permission structure");let t=await e.json();return t.permissions||t}async getAvailableRoles(){let e=await fetch("".concat(this.API_BASE_URL,"/roles"),{headers:this.getAuthHeaders()});if(!e.ok)throw await this.handleAuthError(e),Error((await e.json().catch(()=>({}))).error||"Failed to fetch available roles");let t=await e.json();return t.roles||t}constructor(){this.API_BASE_URL=(0,a.h)()}}let o=new s},9959:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,y:()=>o});let a=(0,r(1008).h)();class s{getAuthHeaders(){let e=this.getToken();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}async login(e){let t=await fetch("".concat(a,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw Error(r.error||"Login failed");return r.token&&(this.setToken(r.token),this.setUser(r.user),this.setOrganization(r.organization)),r}async register(e){let t=await fetch("".concat(a,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw Error(r.error||"Registration failed");return r}async refreshToken(){let e=this.getToken();if(!e)throw Error("No token available for refresh");let t=await fetch("".concat(a,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),r=await t.json();if(!t.ok)throw Error(r.error||"Token refresh failed");return this.setToken(r.token),r.token}async logout(){try{this.getToken()&&await fetch("".concat(a,"/auth/logout"),{method:"POST",headers:this.getAuthHeaders()})}catch(e){console.warn("Logout API call failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_organization")}}getToken(){return localStorage.getItem("auth_token")}setToken(e){localStorage.setItem("auth_token",e)}getUser(){{let e=localStorage.getItem("auth_user");return e?JSON.parse(e):null}}setUser(e){localStorage.setItem("auth_user",JSON.stringify(e))}getOrganization(){{let e=localStorage.getItem("auth_organization");return e?JSON.parse(e):null}}setOrganization(e){localStorage.setItem("auth_organization",JSON.stringify(e))}isAuthenticated(){return!!this.getToken()}isTokenExpired(){let e=this.getToken();if(!e)return!0;try{let t=JSON.parse(atob(e.split(".")[1])),r=Date.now()/1e3;return t.exp<r}catch(e){return!0}}async ensureValidToken(){if(!this.isAuthenticated())return null;if(this.isTokenExpired())try{return await this.refreshToken()}catch(e){return localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_organization"),null}return this.getToken()}}let o=new s,n=o}},e=>{e.O(0,[441,964,977],()=>e(e.s=5642)),_N_E=e.O()}]);