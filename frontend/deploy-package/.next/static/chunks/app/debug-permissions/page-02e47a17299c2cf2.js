(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[375],{1008:(e,t,a)=>{"use strict";a.d(t,{h:()=>s});let r="https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api";console.log("API Configuration:",{NEXT_PUBLIC_API_URL:"https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api",FINAL_API_URL:r});let n={BASE_URL:r},s=()=>(console.log("=== API BASE URL DEBUG ==="),console.log("Environment Variable NEXT_PUBLIC_API_URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Fallback URL:","https://liase-backend-fpc8gsbrghgacdgx.centralindia-01.azurewebsites.net/api"),console.log("Final API_CONFIG.BASE_URL:",n.BASE_URL),console.log("========================="),n.BASE_URL)},3318:(e,t,a)=>{Promise.resolve().then(a.bind(a,5557))},5038:(e,t,a)=>{"use strict";a.d(t,{Bk:()=>u,QT:()=>c,Sk:()=>l,XI:()=>i});var r=a(5155),n=a(2115),s=a(6681);let o=(0,n.createContext)(null);function i(e){let{children:t}=e,{user:a,isAuthenticated:n}=(0,s.h)(),i=e=>!!a&&!!n&&a.role===e;return(0,r.jsx)(o.Provider,{value:{hasPermission:(e,t)=>{var r;return!!a&&!!n&&!!a.permissions&&(null==(r=a.permissions[e])?void 0:r[t])===!0},hasRole:i,isAdmin:()=>!!a&&!!n&&(i("admin")||i("superadmin")),isSuperAdmin:()=>!!a&&!!n&&i("superadmin")},children:t})}function l(){let e=(0,n.useContext)(o);if(!e)throw Error("usePermissions must be used within a PermissionProvider");return e}function u(e){let{children:t,resource:a,action:n,roles:s,fallback:o=null,requireAll:i=!1}=e;try{let{hasPermission:e,hasRole:u}=l();if(!(()=>{let t=[];return a&&n&&t.push(e(a,n)),s&&s.length>0&&(i?t.push(s.every(e=>u(e))):t.push(s.some(e=>u(e)))),0===t.length||(i?t.every(e=>e):t.some(e=>e))})())return(0,r.jsx)(r.Fragment,{children:o});return(0,r.jsx)(r.Fragment,{children:t})}catch(e){return console.warn("PermissionGate error:",e),(0,r.jsx)(r.Fragment,{children:o})}}function c(){let{hasPermission:e,hasRole:t,isAdmin:a,isSuperAdmin:r}=l();return{hasPermission:e,hasRole:t,isAdmin:a,isSuperAdmin:r,canAccess:(t,a)=>e(t,a),canManageUsers:()=>e("users","write"),canManageRoles:()=>e("roles","write"),canDeleteUsers:()=>e("users","delete"),canDeleteRoles:()=>e("roles","delete"),canViewAuditLogs:()=>e("audit","read"),canManageOrganization:()=>e("organizations","write")}}},5557:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var r=a(5155),n=a(2115),s=a(5038),o=a(1008);function i(){let[e,t]=(0,n.useState)({}),[a,i]=(0,n.useState)(null),{hasPermission:l,hasRole:u,isAdmin:c,isSuperAdmin:d}=(0,s.Sk)();(0,n.useEffect)(()=>{try{let e=localStorage.getItem("auth_user"),a=e?JSON.parse(e):null;i(a);let r={"users:read":l("users","read"),"users:write":l("users","write"),"users:delete":l("users","delete"),"roles:read":l("roles","read"),"roles:write":l("roles","write"),"roles:delete":l("roles","delete")},n={isAdmin:c(),isSuperAdmin:d(),hasAdminRole:u("admin"),hasSuperAdminRole:u("superadmin")};t({permissions:r,roles:n,userRole:null==a?void 0:a.role,organizationId:null==a?void 0:a.organizationId})}catch(e){console.error("Error loading debug info:",e)}},[l,u,c,d]);let h=async e=>{try{let t=localStorage.getItem("auth_token"),a=await fetch("".concat((0,o.h)()).concat(e),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),r=await a.json();alert("".concat(e," Response: ").concat(a.status,"\n").concat(JSON.stringify(r,null,2)))}catch(t){alert("".concat(e," Error: ").concat(t))}};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Permissions Debug"}),(0,r.jsxs)("div",{className:"grid gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Current User"}),(0,r.jsx)("pre",{className:"bg-gray-100 p-4 rounded text-sm overflow-auto",children:JSON.stringify(a,null,2)})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Permission Checks"}),(0,r.jsx)("pre",{className:"bg-gray-100 p-4 rounded text-sm overflow-auto",children:JSON.stringify(e,null,2)})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"API Tests"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,r.jsx)("button",{onClick:()=>h("/users"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"Test /users"}),(0,r.jsx)("button",{onClick:()=>h("/roles"),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded",children:"Test /roles"}),(0,r.jsx)("button",{onClick:()=>h("/health"),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded",children:"Test /health"})]})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{onClick:()=>window.location.href="/dashboard/user-management",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"Back to User Management"}),(0,r.jsx)("button",{onClick:()=>window.location.href="/debug-auth",className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded",children:"Auth Debug"})]})]})]})})}},6681:(e,t,a)=>{"use strict";a.d(t,{h:()=>o});var r=a(4540),n=a(2115),s=a(7218);let o=()=>{let e=(0,r.wA)(),{user:t,organization:a,isAuthenticated:o,isLoading:i,error:l}=(0,r.d4)(e=>e.auth),u=(0,n.useCallback)(async t=>await e((0,s.Lx)(t)),[e]),c=(0,n.useCallback)(async t=>await e((0,s.d3)(t)),[e]),d=(0,n.useCallback)(async()=>await e((0,s.y4)()),[e]),h=(0,n.useCallback)(()=>{e((0,s.ET)())},[e]);return{user:t,organization:a,isAuthenticated:o,isLoading:i,error:l,login:u,register:c,logout:d,clearError:h,checkAuth:(0,n.useCallback)(async()=>await e((0,s.z)()),[e]),refreshToken:(0,n.useCallback)(async()=>await e((0,s.B3)()),[e])}}},7218:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>g,B3:()=>i,ET:()=>d,Lx:()=>s,d3:()=>o,y4:()=>l,z:()=>u});var r=a(1990),n=a(9959);let s=(0,r.zD)("auth/login",async(e,t)=>{let{rejectWithValue:a}=t;try{return await n.A.login(e)}catch(e){return a(e.message||"Login failed")}}),o=(0,r.zD)("auth/register",async(e,t)=>{let{rejectWithValue:a}=t;try{return await n.A.register(e)}catch(e){return a(e.message||"Registration failed")}}),i=(0,r.zD)("auth/refreshToken",async(e,t)=>{let{rejectWithValue:a}=t;try{return{token:await n.A.refreshToken()}}catch(e){return a(e.message||"Token refresh failed")}}),l=(0,r.zD)("auth/logout",async()=>{await n.A.logout()}),u=(0,r.zD)("auth/checkStatus",async(e,t)=>{let{rejectWithValue:a}=t;try{if(!n.A.isAuthenticated())throw Error("Not authenticated");let e=await n.A.ensureValidToken();if(!e)throw Error("Invalid token");let t=n.A.getUser(),a=n.A.getOrganization();return{user:t,organization:a,token:e}}catch(e){return a(e.message||"Authentication check failed")}}),c=(0,r.Z0)({name:"auth",initialState:{user:null,organization:null,token:null,isAuthenticated:!1,isLoading:!1,error:null},reducers:{clearError:e=>{e.error=null},setCredentials:(e,t)=>{e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}},extraReducers:e=>{e.addCase(s.pending,e=>{e.isLoading=!0,e.error=null}).addCase(s.fulfilled,(e,t)=>{e.isLoading=!1,e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(s.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload,e.isAuthenticated=!1,e.user=null,e.organization=null,e.token=null}).addCase(o.pending,e=>{e.isLoading=!0,e.error=null}).addCase(o.fulfilled,e=>{e.isLoading=!1,e.error=null}).addCase(o.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload}).addCase(i.fulfilled,(e,t)=>{e.token=t.payload.token}).addCase(i.rejected,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1}).addCase(u.fulfilled,(e,t)=>{e.user=t.payload.user,e.organization=t.payload.organization,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(u.rejected,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1}).addCase(l.fulfilled,e=>{e.user=null,e.organization=null,e.token=null,e.isAuthenticated=!1,e.error=null})}}),{clearError:d,setCredentials:h}=c.actions,g=c.reducer},9959:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,y:()=>s});let r=(0,a(1008).h)();class n{getAuthHeaders(){let e=this.getToken();return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}async login(e){let t=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.error||"Login failed");return a.token&&(this.setToken(a.token),this.setUser(a.user),this.setOrganization(a.organization)),a}async register(e){let t=await fetch("".concat(r,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.error||"Registration failed");return a}async refreshToken(){let e=this.getToken();if(!e)throw Error("No token available for refresh");let t=await fetch("".concat(r,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),a=await t.json();if(!t.ok)throw Error(a.error||"Token refresh failed");return this.setToken(a.token),a.token}async logout(){try{this.getToken()&&await fetch("".concat(r,"/auth/logout"),{method:"POST",headers:this.getAuthHeaders()})}catch(e){console.warn("Logout API call failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_organization")}}getToken(){return localStorage.getItem("auth_token")}setToken(e){localStorage.setItem("auth_token",e)}getUser(){{let e=localStorage.getItem("auth_user");return e?JSON.parse(e):null}}setUser(e){localStorage.setItem("auth_user",JSON.stringify(e))}getOrganization(){{let e=localStorage.getItem("auth_organization");return e?JSON.parse(e):null}}setOrganization(e){localStorage.setItem("auth_organization",JSON.stringify(e))}isAuthenticated(){return!!this.getToken()}isTokenExpired(){let e=this.getToken();if(!e)return!0;try{let t=JSON.parse(atob(e.split(".")[1])),a=Date.now()/1e3;return t.exp<a}catch(e){return!0}}async ensureValidToken(){if(!this.isAuthenticated())return null;if(this.isTokenExpired())try{return await this.refreshToken()}catch(e){return localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_organization"),null}return this.getToken()}}let s=new n,o=s}},e=>{e.O(0,[635,441,964,977],()=>e(e.s=3318)),_N_E=e.O()}]);